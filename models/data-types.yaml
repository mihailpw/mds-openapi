title: MDS common data types
description: Shared schema definitions used across MDS OpenAPI.
type: object

x-stoplight:
  id: vfaag0vpz3odt

properties:
  area_type:
    type: string
    description: The type of a service area.
    enum:
      - unrestricted
      - restricted
      - preferred_pick_up
      - preferred_drop_off

  currency:
    type:
      - string
      - "null"
    pattern: ^[A-Z]{3}$
    default: USD
    description:
      An ISO 4217 Alphabetic Currency Code representing currency of the
      payee. If null, USD cents is implied.
    examples:
      - USD
      - EUR
      - GBP

  day:
    type: string
    description: A day of the week.
    enum:
      - sun
      - mon
      - tue
      - wed
      - thu
      - fri
      - sat

  days:
    type: array
    description: An array of days of the week.
    items:
      $ref: "#/properties/day"
    uniqueItems: true

  geojson_point:
    description: GeoJSON [Point](https://geojson.org/schema/Point.json) schema.
    type: object
    required:
      - type
      - coordinates
    properties:
      type:
        type: string
        enum:
          - Point
      coordinates:
        type: array
        minItems: 2
        items:
          - type: number
            minimum: -180
            maximum: 180
          - type: number
            minimum: -90
            maximum: 90
        maxItems: 2
      bbox:
        type: array
        minItems: 4
        items:
          type: number

  integer_positive:
    type: integer
    minimum: 0
    description: An integer greater than or equal to 0.

  iso_dayhour:
    type: string
    description: An ISO 8601 extended datetime representing an UTC hour between 00 and 23 `YYYY-MM-DDTHH`; valid for dates in 2018 and later.
    pattern: ^(201[89]|20[2-9]\d|2[1-9]\d{2}|[3-9]\d{3})-(0[1-9]|1[02])-([12]\d|0[1-9]|3[01])T([0-2][0-3]|[01]\d)$
    examples:
      - "2023-12-31T23"
      - "2024-01-01T01"

  iso_time:
    type: string
    description: Time-of-day expressed as ISO 8601 `hh:mm:ss`.
    pattern: ([0-2][0-3]|[01]\d):[0-5]\d:[0-5]\d
    examples:
      - "23:59:59"
      - "00:00:01"

  mds_geojson_feature:
    type: object
    description: MDS-specific definition of the [GeoJSON Feature](https://geojson.org/schema/Feature.json) restricting `geometry` to [Point](https://geojson.org/schema/Point.json).
    required:
      - type
      - properties
      - geometry
    properties:
      type:
        type: string
        enum:
          - Feature
      id:
        oneOf:
          - type: number
          - type: string
      properties:
        type: object
        required:
          - timestamp
        properties:
          timestamp:
            $ref: "#/properties/timestamp"
          stop_id:
            $ref: "#/properties/uuid"
          altitude:
            type: number
            description: Altitude above mean sea level in meters.
          heading:
            type: number
            description: Degrees - clockwise starting at 0 degrees at true North.
          speed:
            type: number
            description: Estimated speed in meters / sec as reported by the GPS chipset.
          accuracy:
            type: number
            description: Horizontal accuracy, in meters.
          hdop:
            type: number
            description: Horizontal GPS or GNSS accuracy value.
          satellites:
            type: integer
            description: Number of GPS or GNSS satellites.
      geometry:
        $ref: "#/properties/geojson_point"
      bbox:
        type: array
        minItems: 4
        items:
          type: number

  minimum_year:
    type: integer
    minimum: 1970
    description: Represents a minimum for fields that capture a year as an integer. Derived from Unix timestamp 0.

  propulsion_type:
    type: string
    description: The allowed types of propulsion in MDS. Based off of `propulsion_type` in [GBFS vehicle_types](https://github.com/MobilityData/gbfs/blob/master/gbfs.md#vehicle_typesjson)
    enum:
      - human
      - electric_assist
      - electric
      - combustion
      - combustion_diesel
      - hybrid
      - hydrogen_fuel_cell
      - plug_in_hybrid

  propulsion_types:
    type: array
    description: Array of propulsion types, allowing multiple values.
    items:
      $ref: "#/properties/propulsion_type"
    uniqueItems: true

  rental_methods:
    type: array
    description: Payment methods accepted at this Stop. From GBFS Station Information.
    items:
      enum:
        - KEY
        - CREDITCARD
        - PAYPASS
        - APPLEPAY
        - ANDROIDPAY
        - TRANSITCARD
        - ACCOUNTNUMBER
        - PHONE
    uniqueItems: true

  stop:
    type: object
    description: The common schema elements for a Stop in MDS.
    required:
      - stop_id
      - name
      - last_reported
      - location
      - status
      - capacity
      - num_vehicles_available
      - num_vehicles_disabled
    properties:
      stop_id:
        $ref: "#/properties/uuid"
        description: UUID for the Stop.
      name:
        $ref: "#/properties/string"
        description: Name of the Stop.
      last_reported:
        $ref: "#/properties/timestamp"
        description: Date/Time of the last status update for this Stop.
      location:
        $ref: "#/properties/mds_geojson_feature"
        description: Location of the stop.
      status:
        $ref: "#/properties/stop_status"
        description: The status of the Stop.
      capacity:
        $ref: "#/properties/vehicle_type_counts"
        description: Number of total places per vehicle_type.
      num_vehicles_available:
        $ref: "#/properties/vehicle_type_counts"
        description: Number of available vehicles per vehicle_type.
      num_vehicles_disabled:
        $ref: "#/properties/vehicle_type_counts"
        description: Number of non_operational/reserved vehicles per vehicle_type.
      provider_id:
        $ref: "#/properties/uuid"
        description:
          UUID for the Provider managing this Stop. Null/undefined if managed
          by an Agency.
      geography_id:
        $ref: "#/properties/uuid"
        description: UUID for the Stop.
      region_id:
        $ref: "#/properties/string"
        description:
          ID of the region where the Stop is located. See GBFS Station
          Information.
      short_name:
        $ref: "#/properties/string"
        description: Abbreviated Stop name.
      address:
        $ref: "#/properties/string"
        description: Postal address (useful for directions).
      post_code:
        $ref: "#/properties/string"
        description: Postal code (e.g. 10036).
      cross_street:
        $ref: "#/properties/string"
        description: Cross street of where Stop is located.
      num_places_available:
        $ref: "#/properties/vehicle_type_counts"
        description: Number of places free to be populated per vehicle_type.
      num_places_disabled:
        $ref: "#/properties/vehicle_type_counts"
        description: Number of places disabled an unable to accept vehicles per vehicle_type.
      parent_stop:
        $ref: "#/properties/uuid"
        description: Describe a basic hierarchy of Stops (e.g. a Stop inside a greater Stop).
      devices:
        $ref: "#/properties/uuid_array"
        description: List of device_id for vehicles currently at this Stop.

  stop_status:
    type: object
    description: Status object for a Stop in MDS.
    required:
      - is_installed
      - is_renting
      - is_returning
    properties:
      is_installed:
        type: boolean
      is_renting:
        type: boolean
      is_returning:
        type: boolean

  string:
    type: string
    description: A length-limited string type.
    maxLength: 255
    examples:
      - ABC123
    pattern: ^(.*)$

  telemetry:
    type: object
    description: A telemetry datum.
    additionalProperties: false
    properties:
      altitude:
        type: number
        description: Altitude above mean sea level in meters.
      heading:
        type: number
        description: Degrees - clockwise starting at 0 degrees at true North.
      speed:
        type: number
        description: Estimated speed in meters / sec as reported by the GPS chipset.
      accuracy:
        type: number
        description: Horizontal accuracy, in meters.
      hdop:
        type: number
        description: Horizontal GPS or GNSS accuracy value.
      satellites:
        type: integer
        description: Number of GPS or GNSS satellites.

  timestamp:
    type: number
    description: Integer milliseconds since Unix epoch.
    multipleOf: 1
    minimum: 1514764800000

  trip_id_reference:
    description: Conditionally require a trip_id reference.
    anyOf:
      - not:
          properties:
            event_types:
              contains:
                enum:
                  - trip_cancel
                  - trip_end
                  - trip_enter_jurisdiction
                  - trip_leave_jurisdiction
                  - trip_start
      - required:
          - trip_id

  ttl:
    type: integer
    description: Integer milliseconds until next data update (0 if the data is.
      always refreshed)
    minimum: 0
    maximum: 300000

  uuid:
    type: string
    description: A UUID used to uniquely identity an object.
    examples:
      - 3c9604d6-b5ee-11e8-96f8-529269fb1459
    pattern: ^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$

  uuid_array:
    type: array
    description: Array of UUID.
    items:
      $ref: "#/properties/uuid"

  vehicle_event:
    type: string
    description: An event that changes a vehicle's state.
    enum:
      - agency_drop_off
      - agency_pick_up
      - battery_charged
      - battery_low
      - comms_lost
      - comms_restored
      - compliance_pick_up
      - decommissioned
      - located
      - maintenance
      - maintenance_pick_up
      - missing
      - off_hours
      - on_hours
      - provider_drop_off
      - rebalance_pick_up
      - reservation_cancel
      - reservation_start
      - system_resume
      - system_suspend
      - trip_cancel
      - trip_end
      - trip_enter_jurisdiction
      - trip_leave_jurisdiction
      - trip_start
      - unspecified

  vehicle_events:
    type: array
    description: Array of events indicating a change to a vehicle's state.
    uniqueItems: true
    minItems: 1
    items:
      $ref: "#/properties/vehicle_event"

  vehicle_state:
    type: string
    description: The state of a vehicle.
    enum:
      - available
      - elsewhere
      - non_operational
      - on_trip
      - removed
      - reserved
      - unknown

  vehicle_state_transitions:
    description: valid vehicle_state and vehicle_events combinations.
    oneOf:
      - properties:
          vehicle_state:
            const: available
          vehicle_events:
            contains:
              enum:
                - agency_drop_off
                - battery_charged
                - comms_restored
                - located
                - maintenance
                - on_hours
                - provider_drop_off
                - reservation_cancel
                - system_resume
                - trip_cancel
                - trip_end
                - unspecified
      - properties:
          vehicle_state:
            const: elsewhere
          vehicle_events:
            contains:
              enum:
                - comms_restored
                - located
                - trip_leave_jurisdiction
                - unspecified
      - properties:
          vehicle_state:
            const: non_operational
          vehicle_events:
            contains:
              enum:
                - battery_low
                - comms_restored
                - located
                - maintenance
                - off_hours
                - system_suspend
                - unspecified
      - properties:
          vehicle_state:
            const: on_trip
          vehicle_events:
            contains:
              enum:
                - comms_restored
                - located
                - trip_enter_jurisdiction
                - trip_start
                - unspecified
      - properties:
          vehicle_state:
            const: removed
          vehicle_events:
            contains:
              enum:
                - agency_pick_up
                - comms_restored
                - compliance_pick_up
                - decommissioned
                - located
                - maintenance_pick_up
                - rebalance_pick_up
                - unspecified
      - properties:
          vehicle_state:
            const: reserved
          vehicle_events:
            contains:
              enum:
                - comms_restored
                - located
                - reservation_start
                - unspecified
      - properties:
          vehicle_state:
            const: unknown
          vehicle_events:
            contains:
              enum:
                - comms_lost
                - missing
                - unspecified

  vehicle_telemetry:
    type: object
    description: A telemetry datum for a specific vehicle at a specific time.
    required:
      - device_id
      - timestamp
      - gps
    additionalProperties: false
    properties:
      device_id:
        $ref: "#/properties/uuid"
      timestamp:
        $ref: "#/properties/timestamp"
      gps:
        type: object
        required:
          - lat
          - lng
        additionalProperties: false
        properties:
          lat:
            type: number
            description: Latitude of the location.
            minimum: -90
            maximum: 90
          lng:
            type: number
            description: Longitude of the location.
            minimum: -180
            maximum: 180
      charge:
        type: number
        description: Fraction of charge of the vehicle (required if applicable).
        minimum: 0
        maximum: 1

  vehicle_type:
    type: string
    description: The allowed types of of vehicles in MDS. Based off of `form_factor` in [GBFS vehicle_types](https://github.com/MobilityData/gbfs/blob/master/gbfs.md#vehicle_typesjson), with some additional to support MDS modes.
    enum:
      - bicycle
      - bus
      - cargo_bicycle
      - car
      - delivery_robot
      - moped
      - motorcycle
      - scooter_standing
      - scooter_seated
      - truck
      - other

  vehicle_types:
    type: array
    description: Array of vehicle types.
    items:
      $ref: "#/properties/vehicle_type"
    uniqueItems: true

  vehicle_type_counts:
    type: object
    properties:
      bicycle:
        type: integer
        minimum: 0
      cargo_bicycle:
        type: integer
        minimum: 0
      car:
        type: integer
        minimum: 0
      scooter:
        type: integer
        minimum: 0
      moped:
        type: integer
        minimum: 0
      other:
        type: integer
        minimum: 0
    additionalProperties: false
